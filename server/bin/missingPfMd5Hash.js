#!/usr/bin/env node

// select distinct "encodingId" from "Videos" where "encodingId" is not null and "pfMd5Hash" is null
var encodingIdList = [
  "6e350d7e9d344a65",
  "e1e433cb1e338fb6",
  "0220acc39afe3f33",
  "3cc99b1969aa7c78",
  "902201fbf1087ffc",
  "4ef709c119cab66b",
  "4ef709c119cab66b",
  "4ef709c119cab66b",
  "72c570650fc0a95a",
  "eca25db1b4c38072",
  "ffdca4fae1849c99",
  "b57724bdf19bc097",
  "c98f9889207c9b56",
  "920bcb65ff6ff2c8",
  "cf10cb1ddc825714",
  "5a9c5dcc1ab9df54",
  "c561f18c45fcd00d",
  "e508b188f72e858f",
  "e2611d9d5253d2f3",
  "3ab8b66b8b10b1fa",
  "27099f462d623be9",
  "6be6bfb876a3700e",
  "53a7f98e6287cad3",
  "c81746107e7c89a8",
  "d7efbbdb83c6739b",
  "4d66ede335a3ddba",
  "b783eb27eaaf736c",
  "79760f6b7fcd93f4",
  "1db198bd84702689",
  "fa8a483808c032ca",
  "5b339b4c3480f41f",
  "e1601c4cab6bb247",
  "4ae493efafb78d8d",
  "5dfb1725669bf0e5",
  "57874c51c029203b",
  "9fd976a90e63b686",
  "2bca37907319deed",
  "8bb5e12b236accea",
  "bf632a412037373d",
  "b50b9465af403984",
  "5c5d2be74efbdc00",
  "eed309b43db223ef",
  "1d3316cc3095284e",
  "34d826b3fc9d1568",
  "beb033f72cbac4b4",
  "21e565e417bd0e28",
  "644b4119b656d65f",
  "386e3c5a1375faa1",
  "11156641eb71ca7d",
  "6a53d134e4a9c378",
  "c65aa147b5d0cfef",
  "98575fca123a09f0",
  "a7b1dc843f59e198",
  "fee443d84e16d92c",
  "55dc3d3e2ab27604",
  "39b339bbddd84bc2",
  "5637d646afe514e1",
  "62007351cf9d2d7f",
  "1de2af809d70935c",
  "9b14b2c2ac92cee3",
  "b6f69783a5a4efac",
  "b23628b16662a2de",
  "6cdd1e68a9b8ecd1",
  "8c8cf93b94becc36",
  "46e01ddd7519fd34",
  "ee1800a482557155",
  "29ff1612ddb24570",
  "69b463b5c0c7fac4",
  "47d70a1ed83785f2",
  "0128281a1bab8bf0",
  "e183edcff2637a99",
  "180c5fd0ba9ffea5",
  "0d8a72ab42eac098",
  "efbd4c7a7ad41d22",
  "a8992d6133eba93e",
  "795866ac7f163e1a",
  "22eaa2ff233b464e",
  "02535e2399a926a8",
  "bdca06140721324e",
  "874c9857ad1394ad",
  "cea8a86d3681f4a0",
  "d67265a789698ad0",
  "877eb16922bdbf9a",
  "6b374e96eeec1db9",
  "aacca7aeb63aa9b8",
  "064609571b058281",
  "e82685f648fd2c01",
  "d6ba591448a72288",
  "ab3bf92c208a22ba",
  "52ef222968508148",
  "584ee98edb7801a1",
  "0e5ddc974270304b",
  "a8c79718cd01b641",
  "7c442f0b63424003",
  "b25552bf920b82c5",
  "f4565cd07fc24d41",
  "2b398bc245eb5764",
  "f3574a6faba35a5b",
  "4269d5fac2cb6c83",
  "c3a3774d972bbd07",
  "56f74fb0c568c545",
  "2dbb03340c39b43b",
  "1150e30f874167ef",
  "fa9c3421cd35efc1",
  "b165ecbba481ed35",
  "e4511e29b29bad2f",
  "bd2a914c6f73a954",
  "db7d69b1341dcdfc",
  "0fd48f01884b4d51",
  "08cc99ed6b2d545e",
  "612776303fb823ad",
  "8cd80242a5d6f90d",
  "7f05e0fad1c33ba7",
  "42ce5b1edeb4f685",
  "b000fa9644ec9f38",
  "b915dccf01eb4d26",
  "45cd6dd7c01d7339",
  "6122c65593ffea3c",
  "de7df201630325b9",
  "1149062f095c71cb",
  "3e4ea860b4eb4c31",
  "089b29c514c10c00",
  "60fae0014be1f989",
  "5890bd647f0734de",
  "055ef13facc3e972",
  "b7c7a0f735d7c6ab",
  "ac16f55e897b3eb1",
  "6a38aea96c56b120",
  "b7d86b179eb47d89",
  "e4065eb820516353",
  "21e7f3cf4ddd4a98",
  "14ba01c2c6a332c5",
  "1b1a80e0311aefe3",
  "bbac53e60893fa6c",
  "42d1218dfbe75202",
  "4d412a5d229c3285",
  "dcc4ef38061b703d",
  "288e494fe50d2355",
  "ff5ca2694f30cd60",
  "072b7097bdfcbb67",
  "11e6e5adbb9659af",
  "da8ed52dd66b74e3",
  "a2c9ebb2e2bfcf7b",
  "d98d29e639600962",
  "3c732208304a9e3d",
  "d4ef1b9bc6ae8e07",
  "c0e48b7493d8f7c7",
  "a10437a68acf9af3",
  "237e30f5703d5911",
  "7f77945c388ad6b2",
  "1f43faee5dfa4b1c",
  "3a3f46f814c44b74",
  "4bdf1643ce491843",
  "b4687290e10162b1",
  "217fbce9b89552de",
  "ead20331d6b4fa37",
  "7ee9965e94e7cf75",
  "b973fb630783e518",
  "a4d014146a90f6e5",
  "a008a1b96755cbbd",
  "50e0913ad80642cd",
  "3505fb5e85811034",
  "4c41496b0bce786b",
  "6e1a6493220e129f",
  "3f788122e8fe1b0d",
  "7d8af988c5590100",
  "b3563a1897514d2f",
  "3eeeb440a0cbb587",
  "87ccaf548a8c7703",
  "7f3d292c882b198a",
  "ded78790b18f7cd2",
  "d0583dffbd44d416",
  "b17ca4e316a6b670",
  "65f03587c0f71450",
  "71437d2402f4ad91",
  "b0037913c23a9983",
  "56505f0d2603fb47",
  "2b9a455432508118",
  "3af6f6dbafd1bfc4",
  "d45458386744cedb",
  "539ea81e92d7b651",
  "cdf3990451593e76",
  "fe9db4f079d58dcd",
  "c0fde7997427ca6b",
  "1e721b47213ed7a2",
  "8633ff123c1bd840",
  "1292d9e5e9212e56",
  "1beac89efbc0f6e2",
  "3c99944c96d4e238",
  "3913874d09184ac5",
  "21878361f789fd29",
  "3e09d76836dd8dfe",
  "3d4d6ad617eb4d96",
  "70caffaa9fa9c4a0",
  "028dfd094644d6dc",
  "7723fe498c2909c3",
  "3f6d53c93686d14a",
  "98a3776d81901d34",
  "9ba871562c24a125",
  "cf26afe7aa84cc8c",
  "3e017eb78c81d0ec",
  "6092063971f3b10f",
  "d3cd983315f1cd58",
  "45ccf7facfc702ca",
  "60f794d152aa9aa9",
  "a71a1cfb55e67e31",
  "491fcec158c95bde",
  "339014884f809971",
  "578d71fdff675a52",
  "bd2d501caeb18b14",
  "a43da27d2eeeeb1b",
  "730f35bab6371914",
  "0fdc6369d6e7fe57",
];

var Q = require('q');
var request = require('request');

// try to know the pfMd5Hash
encodingIdList.reduce(function (p, c, i) {
  //if (i > 5) return p;
  return p.then(function () {
    return Q.nfcall(request, { json: true, url: 'http://p-afsmsch-001.afrostream.tv:4000/api/contents?uuid=' + c });
  }).then(function (data) {
    var body = data[1];
    if (!Array.isArray(body)) {
      console.log('-- ERROR: "'+c+'": data = ', JSON.stringify(data));
    } else if (body.length) {
      if (body[0].md5Hash) {
        //console.log('"'+c+'";"'+body[0].md5Hash+'"');
        console.log('UPDATE "Videos" SET "pfMd5Hash" = \'' + body[0].md5Hash + '\' WHERE "encodingId" = \'' + c + '\';');
      }
    } else {
      console.log('-- ERROR: "'+c+'": unknown encodingId in PF ?');
    }
    //console.log('response body', body);
  }, function (err) { console.error(err.message) });
}, Q());
